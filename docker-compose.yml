services:
  lightning-driver:
    build: .
    container_name: rust-lightning-driver
    restart: unless-stopped
    volumes:
      - ./config:/config:ro
      - ./logs:/app/logs
    environment:
      - STRATEGY=Lnd # or ClnRest
      - HOST=http://cln:8080 # for CLN REST
      # - HOST=https://lnd:10009  # for LND (requires mTLS)
      - CERT_PATH=/config/tls.cert
      - MACAROON_PATH=/config/admin.macaroon
    network_mode: host # Required to reach local LND/CLN
    # ports:
    #   - "8080:8080"         # Optional: expose driver as API later

  # Optional: Run CLN with REST enabled
  cln:
    image: elementsproject/lightningd:latest
    command: >
      --network=regtest
      --rest-port=8080
      --rest-host=0.0.0.0
      --developer
    ports:
      - "8080:8080"
    volumes:
      - cln-data:/root/.lightning
    network_mode: host

volumes:
  cln-data:
